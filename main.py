import os
import logging
import asyncio
from datetime import datetime
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command, StateFilter
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.storage.memory import MemoryStorage
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode
from flask import Flask, request
import threading

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Replit
BOT_TOKEN = os.getenv("BOT_TOKEN")
ADMIN_ID = os.getenv("ADMIN_ID")

if not BOT_TOKEN:
    logger.error("‚ùå BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
    # –í Replit –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
    BOT_TOKEN = input("–í–≤–µ–¥–∏—Ç–µ BOT_TOKEN: ")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
bot = Bot(
    token=BOT_TOKEN,
    default=DefaultBotProperties(parse_mode=ParseMode.HTML)
)
storage = MemoryStorage()
dp = Dispatcher(storage=storage)

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∞–Ω–∫–µ—Ç—ã
class Questionnaire(StatesGroup):
    company_name = State()
    inn = State()
    contact_person = State()
    phone = State()
    email = State()
    activity_sphere = State()
    industry = State()
    contract_amount = State()
    regions = State()

# =========== –ö–õ–ê–í–ò–ê–¢–£–†–´ ===========
def get_main_keyboard():
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    return ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É")],
            [KeyboardButton(text="üìã –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ"), KeyboardButton(text="‚ÑπÔ∏è –ü–æ–º–æ—â—å")],
            [KeyboardButton(text="üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã")]
        ],
        resize_keyboard=True,
        input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ"
    )

def get_cancel_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã"""
    return ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="üö´ –û—Ç–º–µ–Ω–∏—Ç—å")]
        ],
        resize_keyboard=True
    )

# =========== –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê ===========
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    """–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º"""
    await message.answer(
        "üè¢ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤</b>\n\n"
        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–µ–Ω–¥–µ—Ä—ã –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞.\n\n"
        "<b>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</b>\n"
        "‚Ä¢ üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É –¥–ª—è –ø–æ–∏—Å–∫–∞\n"
        "‚Ä¢ üìã –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ\n"
        "‚Ä¢ üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∏–∂–µ üëá",
        reply_markup=get_main_keyboard()
    )

@dp.message(F.text == "üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É")
async def start_questionnaire(message: types.Message, state: FSMContext):
    """–ù–∞—á–∞–ª–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∞–Ω–∫–µ—Ç—ã"""
    current_state = await state.get_state()
    if current_state:
        await message.answer("–í—ã —É–∂–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç–µ –∞–Ω–∫–µ—Ç—É. –ó–∞–∫–æ–Ω—á–∏—Ç–µ –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç–µ –µ—ë.")
        return
    
    await message.answer(
        "üìã <b>–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã</b>\n\n"
        "–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ 9 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤.\n"
        "–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏:</b>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.company_name)

@dp.message(Questionnaire.company_name)
async def process_company_name(message: types.Message, state: FSMContext):
    await state.update_data(company_name=message.text)
    await message.answer(
        "‚úÖ <b>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ</b>\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù –∫–æ–º–ø–∞–Ω–∏–∏ (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä):</b>\n"
        "<i>–ü—Ä–∏–º–µ—Ä: 1234567890</i>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.inn)

@dp.message(Questionnaire.inn)
async def process_inn(message: types.Message, state: FSMContext):
    inn = message.text.strip()
    if not inn.isdigit() or len(inn) not in [10, 12]:
        await message.answer("‚ùå –ò–ù–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä. –í–≤–µ–¥–∏—Ç–µ —Å–Ω–æ–≤–∞:")
        return
    await state.update_data(inn=inn)
    await message.answer(
        "‚úÖ <b>–ò–ù–ù —Å–æ—Ö—Ä–∞–Ω–µ–Ω</b>\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ –§–ò–û –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞:</b>\n"
        "<i>–ü—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á</i>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.contact_person)

@dp.message(Questionnaire.contact_person)
async def process_contact_person(message: types.Message, state: FSMContext):
    await state.update_data(contact_person=message.text)
    await message.answer(
        "‚úÖ <b>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ</b>\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</b>\n"
        "<i>–ü—Ä–∏–º–µ—Ä: +7 999 123-45-67</i>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.phone)

@dp.message(Questionnaire.phone)
async def process_phone(message: types.Message, state: FSMContext):
    await state.update_data(phone=message.text)
    await message.answer(
        "‚úÖ <b>–¢–µ–ª–µ—Ñ–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω</b>\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ email:</b>\n"
        "<i>–ü—Ä–∏–º–µ—Ä: info@company.ru</i>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.email)

@dp.message(Questionnaire.email)
async def process_email(message: types.Message, state: FSMContext):
    email = message.text.strip()
    if "@" not in email:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email:")
        return
    await state.update_data(email=email)
    await message.answer(
        "‚úÖ <b>Email —Å–æ—Ö—Ä–∞–Ω–µ–Ω</b>\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ —Å—Ñ–µ—Ä—É –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:</b>\n"
        "<i>–ü—Ä–∏–º–µ—Ä: –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, –û–ö–í–≠–î 41.20</i>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.activity_sphere)

@dp.message(Questionnaire.activity_sphere)
async def process_activity_sphere(message: types.Message, state: FSMContext):
    await state.update_data(activity_sphere=message.text)
    await message.answer(
        "‚úÖ <b>–°—Ñ–µ—Ä–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞</b>\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞/–æ—Ç—Ä–∞—Å–ª—å:</b>\n"
        "<i>–ü—Ä–∏–º–µ—Ä: —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, —Ä–µ–º–æ–Ω—Ç, –º–æ–Ω—Ç–∞–∂</i>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.industry)

@dp.message(Questionnaire.industry)
async def process_industry(message: types.Message, state: FSMContext):
    await state.update_data(industry=message.text)
    await message.answer(
        "‚úÖ <b>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã</b>\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:</b>\n"
        "<i>–ü—Ä–∏–º–µ—Ä: 500 000 —Ä—É–±–ª–µ–π</i>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.contract_amount)

@dp.message(Questionnaire.contract_amount)
async def process_contract_amount(message: types.Message, state: FSMContext):
    await state.update_data(contract_amount=message.text)
    await message.answer(
        "‚úÖ <b>–°—É–º–º–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞</b>\n\n"
        "<b>–í–≤–µ–¥–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω—ã —Ä–∞–±–æ—Ç—ã:</b>\n"
        "<i>–ü—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</i>",
        reply_markup=get_cancel_keyboard()
    )
    await state.set_state(Questionnaire.regions)

@dp.message(Questionnaire.regions)
async def process_regions(message: types.Message, state: FSMContext):
    """–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã"""
    user_data = await state.get_data()
    user_data['regions'] = message.text
    user_data['username'] = message.from_user.username
    user_data['user_id'] = message.from_user.id
    user_data['filled_date'] = datetime.now().strftime("%d.%m.%Y %H:%M")
    
    # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    if ADMIN_ID:
        admin_message = f"""
        üìã <b>–ù–û–í–ê–Ø –ê–ù–ö–ï–¢–ê</b>
        
        üë§ <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</b> @{user_data['username'] or '–Ω–µ—Ç'}
        üÜî <b>ID:</b> {user_data['user_id']}
        üìÖ <b>–î–∞—Ç–∞:</b> {user_data['filled_date']}
        
        üè¢ <b>–ö–æ–º–ø–∞–Ω–∏—è:</b> {user_data['company_name']}
        üî¢ <b>–ò–ù–ù:</b> {user_data['inn']}
        üë§ <b>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ:</b> {user_data['contact_person']}
        üìû <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> {user_data['phone']}
        üìß <b>Email:</b> {user_data['email']}
        üè≠ <b>–°—Ñ–µ—Ä–∞:</b> {user_data['activity_sphere']}
        üîë <b>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</b> {user_data['industry']}
        üí∞ <b>–°—É–º–º–∞:</b> {user_data['contract_amount']}
        üåç <b>–†–µ–≥–∏–æ–Ω—ã:</b> {user_data['regions']}
        """
        try:
            await bot.send_message(ADMIN_ID, admin_message)
        except:
            pass
    
    # –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await message.answer(
        "üéâ <b>–ê–Ω–∫–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!</b>\n\n"
        "‚úÖ –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞–Ω—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.\n"
        "üìû –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.\n\n"
        "–°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ!",
        reply_markup=get_main_keyboard()
    )
    
    await state.clear()

@dp.message(F.text == "üö´ –û—Ç–º–µ–Ω–∏—Ç—å")
async def cancel_questionnaire(message: types.Message, state: FSMContext):
    await message.answer(
        "–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã –æ—Ç–º–µ–Ω–µ–Ω–æ.",
        reply_markup=get_main_keyboard()
    )
    await state.clear()

@dp.message(F.text == "üìã –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ")
async def show_my_data(message: types.Message, state: FSMContext):
    user_data = await state.get_data()
    if not user_data:
        await message.answer("–í—ã –µ—â–µ –Ω–µ –∑–∞–ø–æ–ª–Ω—è–ª–∏ –∞–Ω–∫–µ—Ç—É.")
        return
    
    response = f"""
    üìã <b>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:</b>
    
    üè¢ <b>–ö–æ–º–ø–∞–Ω–∏—è:</b> {user_data.get('company_name', '‚Äî')}
    üî¢ <b>–ò–ù–ù:</b> {user_data.get('inn', '‚Äî')}
    üë§ <b>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ:</b> {user_data.get('contact_person', '‚Äî')}
    üìû <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> {user_data.get('phone', '‚Äî')}
    üìß <b>Email:</b> {user_data.get('email', '‚Äî')}
    üè≠ <b>–°—Ñ–µ—Ä–∞:</b> {user_data.get('activity_sphere', '‚Äî')}
    üîë <b>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</b> {user_data.get('industry', '‚Äî')}
    üí∞ <b>–°—É–º–º–∞:</b> {user_data.get('contract_amount', '‚Äî')}
    üåç <b>–†–µ–≥–∏–æ–Ω—ã:</b> {user_data.get('regions', '‚Äî')}
    """
    await message.answer(response)

@dp.message(F.text == "üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã")
async def show_contacts(message: types.Message):
    await message.answer(
        "üìû <b>–ö–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏</b>\n\n"
        "<b>–û–û–û \"–¢—Ä–∏—Ç–∏–∫–∞\"</b>\n"
        "üìç –ê–¥—Ä–µ—Å: –≥. –í–ª–∞–¥–∏–º–∏—Ä\n"
        "üì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (4922) 223-222\n"
        "‚úâÔ∏è Email: info@tritika.ru\n"
        "üåê –°–∞–π—Ç: www.tritika.ru"
    )

@dp.message(F.text == "‚ÑπÔ∏è –ü–æ–º–æ—â—å")
async def show_help(message: types.Message):
    await message.answer(
        "‚ÑπÔ∏è <b>–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É</b>\n\n"
        "<b>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</b>\n"
        "1. –ù–∞–∂–º–∏—Ç–µ 'üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É'\n"
        "2. –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã\n"
        "3. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ\n\n"
        "<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
        "‚Ä¢ /start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
        "‚Ä¢ üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É - –ø–æ–∏—Å–∫ —Ç–µ–Ω–¥–µ—Ä–æ–≤\n"
        "‚Ä¢ üìã –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ - –ø—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∫–µ—Ç—ã\n"
        "‚Ä¢ üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏"
    )

@dp.message()
async def handle_all_messages(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    await message.answer(
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:",
        reply_markup=get_main_keyboard()
    )

# =========== FLASK –°–ï–†–í–ï–† –î–õ–Ø REPLIT ===========
app = Flask(__name__)

@app.route('/')
def home():
    return "ü§ñ Telegram –±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç!"

@app.route('/health')
def health():
    return "‚úÖ –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
def run_bot():
    """–ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞"""
    logger.info("üöÄ –ó–∞–ø—É—Å–∫–∞—é Telegram –±–æ—Ç–∞...")
    asyncio.run(main())

async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    try:
        await dp.start_polling(bot)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    bot_thread = threading.Thread(target=run_bot)
    bot_thread.daemon = True
    bot_thread.start()
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º Flask —Å–µ—Ä–≤–µ—Ä
    app.run(host='0.0.0.0', port=8080)
